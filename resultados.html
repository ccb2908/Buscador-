<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resultados ‚Äî ¬°Lupa!</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    .top-bar {
      padding: 16px;
      border-bottom: 1px solid #ddd;
      background: #fff;
    }

    .search-inline {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .search-inline input {
      width: 260px;
      padding: 10px 14px;
      border-radius: 20px;
      border: 1px solid #ccc;
    }

    .search-inline button {
      border: none;
      background: #6f42c1;
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 16px 0;
      border-bottom: 1px solid #eee;
    }

    .tab {
      padding: 8px 12px;
      cursor: pointer;
      color: #666;
      font-weight: 500;
    }

    .tab.active {
      color: #1b9c48;
      border-bottom: 2px solid #1b9c48;
    }

    .results {
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }

    .panel {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .panel h3 {
      margin: 0 0 8px;
    }

    .panel p {
      margin: 0;
      color: #555;
    }
  </style>
</head>

<body>

  <!-- üîç BARRA SUPERIOR -->
  <div class="top-bar">
    <div class="search-inline">
      <input id="campoBusca" type="text" />
      <button id="btnBuscar">üîç</button>
    </div>
  </div>

  <!-- üß≠ ABAS -->
  <div class="tabs">
    <div class="tab" data-aba="tudo">Tudo</div>
    <div class="tab" data-aba="imagens">Imagens</div>
    <div class="tab" data-aba="videos">V√≠deos</div>
    <div class="tab" data-aba="noticias">Not√≠cias</div>
  </div>

  <!-- üìÑ RESULTADOS -->
  <div class="results" id="areaResultados"></div>

  <!-- üß† SCRIPT -->
<script>
const params = new URLSearchParams(window.location.search);
let termo = params.get("q") || "";
let abaAtual = params.get("aba") || "tudo";

const campoBusca = document.getElementById("campoBusca");
const areaResultados = document.getElementById("lista-resultados");

campoBusca.value = termo;

// ---------------------
// Atualiza URL sem reload
// ---------------------
function atualizarURL() {
  const url = `resultados.html?q=${encodeURIComponent(termo)}&aba=${abaAtual}`;
  history.replaceState(null, "", url);
}

// ---------------------
// Ativa aba visualmente
// ---------------------
document.querySelectorAll(".aba").forEach(btn => {
  btn.classList.toggle(
    "ativa",
    btn.textContent.toLowerCase() === abaAtual
  );
});

// ---------------------
// BUSCA REAL
// ---------------------
async function buscarResultados() {
  if (!termo) return;

  try {
    const res = await fetch("index.json");
    const dados = await res.json();

    areaResultados.innerHTML = "";

    const filtrados = dados.filter(item =>
      item.titulo.toLowerCase().includes(termo.toLowerCase()) ||
      item.descricao.toLowerCase().includes(termo.toLowerCase()) ||
      item.categoria.toLowerCase().includes(termo.toLowerCase())
    );

    if (filtrados.length === 0) {
      areaResultados.innerHTML = "<p>Nenhum resultado encontrado.</p>";
      return;
    }

    filtrados.forEach(item => {
      const div = document.createElement("div");
      div.className = "resultado";
      div.innerHTML = `
        <a href="${item.link}" class="titulo-link">
          <h3>${item.titulo}</h3>
        </a>
        <small>${item.link}</small>
        <p>${item.descricao}</p>
      `;
      areaResultados.appendChild(div);
    });

  } catch (e) {
    console.error("Erro ao carregar index.json", e);
  }
}

// ---------------------
// PAINEL SUPERIOR
// ---------------------
async function carregarPainel() {
  try {
    const res = await fetch("painel.json");
    const dados = await res.json();

    const item = dados.find(p =>
      p.titulo.toLowerCase() === termo.toLowerCase()
    );

    if (!item) return;

    document.getElementById("tituloPainel").textContent = item.titulo;
    document.getElementById("categoriaPainel").textContent = item.categoria;
    document.getElementById("descricaoPainel").textContent = item.descricao;

    const imagens = document.getElementById("imagensPainel");
    imagens.innerHTML = "";

    item.imagens.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      imagens.appendChild(img);
    });

  } catch (e) {
    console.error("Erro ao carregar painel.json", e);
  }
}

// ---------------------
// EVENTOS
// ---------------------
document.getElementById("botaoBusca").onclick = () => {
  termo = campoBusca.value.trim();
  atualizarURL();
  buscarResultados();
  carregarPainel();
};

campoBusca.addEventListener("keypress", e => {
  if (e.key === "Enter") {
    termo = campoBusca.value.trim();
    atualizarURL();
    buscarResultados();
    carregarPainel();
  }
});

// ---------------------
// INICIALIZA√á√ÉO
// ---------------------
if (termo) {
  buscarResultados();
  carregarPainel();
}
</script>

</body>
</html>
